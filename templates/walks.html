<!DOCTYPE html>
<html>
<head>
    <title>Walk History</title>
</head>
<body>
    <h1>Walk History</h1>

    <form id="filter-form">
        <label for="start_date">Start Date:</label>
        <input type="date" id="start_date" name="start_date">

        <label for="end_date">End Date:</label>
        <input type="date" id="end_date" name="end_date">

        <label for="min_distance">Min Distance (km):</label>
        <input type="number" id="min_distance" name="min_distance" step="0.1">

        <label for="max_distance">Max Distance (km):</label>
        <input type="number" id="max_distance" name="max_distance" step="0.1">

        <button type="submit">Filter</button>
    </form>

    <table border="1" id="walks-table" style="margin-top: 20px;">
        <thead>
            <tr>
                <th>ID</th>
                <th>Lat</th>
                <th>Lon</th>
                <th>Distance</th>
                <th>Timestamp</th>
                <th>Temperature</th>
                <th>Condition</th>
                <th>Dog Parks Visited</th>
                <th>Difficulty</th>
                <th>Duration</th>
            </tr>
        </thead>
        <tbody>
            <!-- Rows will go here -->
        </tbody>
    </table>

    <script>
        async function fetchWalks(params = {}) {
            const query = new URLSearchParams(params);
            const response = await fetch('/api/walks?' + query.toString());
            const data = await response.json();
            return data;
        }

        function renderWalksTable(walks) {
            const tbody = document.querySelector('#walks-table tbody');
            tbody.innerHTML = '';
            walks.forEach(walk => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${walk.id}</td>
                    <td>${walk.lat}</td>
                    <td>${walk.lon}</td>
                    <td>${walk.distance}</td>
                    <td>${new Date(walk.timestamp).toLocaleString()}</td>
                    <td>${walk.temperature ?? 'N/A'}</td>
                    <td>${walk.condition ?? 'N/A'}</td>
                    <td>${walk.dog_parks_visited}</td>
                    <td>${walk.difficulty}</td>
                    <td>${walk.duration}</td>
                `;
                tbody.appendChild(row);
            });
        }

        document.getElementById('filter-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            const params = {
                start_date: e.target.start_date.value,
                end_date: e.target.end_date.value,
                min_distance: e.target.min_distance.value,
                max_distance: e.target.max_distance.value,
                page: 1,
                per_page: 10
            };

            // Remove empty params so API isn't confused
            Object.keys(params).forEach(key => {
                if (!params[key]) delete params[key];
            });

            const data = await fetchWalks(params);
            renderWalksTable(data.walks);
        });

        // Load initial data without filters
        fetchWalks({page:1, per_page:10}).then(data => renderWalksTable(data.walks));
    </script>
</body>
</html>
